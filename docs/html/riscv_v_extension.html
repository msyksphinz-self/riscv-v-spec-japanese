

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ja" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ja" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. イントロダクション &mdash; riscv-v-spec-japanese  ドキュメント</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'',
              LANGUAGE:'ja',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="prev" title="RISC-V “V” Extension" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> riscv-v-spec-japanese
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. イントロダクション</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id2">2. 実装により決定される定数パラメータ</a></li>
<li class="toctree-l1"><a class="reference internal" href="#id3">3. ベクトル拡張のプログラミングモデル</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id4">3.1 ベクトルレジスタ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vtype">3.2 ベクトル型レジスタ, <code class="docutils literal notranslate"><span class="pre">vtype</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#vsew">3.2.1. ベクトル標準エレメント幅<code class="docutils literal notranslate"><span class="pre">vsew</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#vlmul">3.2.2 ベクトルレジスタグルーピング(<code class="docutils literal notranslate"><span class="pre">vlmul</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#vill">3.2.3. ベクトルタイプ不正 <code class="docutils literal notranslate"><span class="pre">vill</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#vl">3.3. ベクトル長レジスタ<code class="docutils literal notranslate"><span class="pre">vl</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#csrvstart">3.4. ベクトルスタートインデックスCSR<code class="docutils literal notranslate"><span class="pre">vstart</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#vxrm">3.5. ベクトル固定小数点丸目モードレジスタ<code class="docutils literal notranslate"><span class="pre">vxrm</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#vxsat">3.6. ベクトル固定小数点飽和フラグ<code class="docutils literal notranslate"><span class="pre">vxsat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#fcsr">3.7. <code class="docutils literal notranslate"><span class="pre">fcsr</span></code>のベクトル固定小数点フィールド</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">3.8. ベクトル拡張のリセット状態について</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">riscv-v-spec-japanese</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>1. イントロダクション</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/riscv_v_extension.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Version 0.7.2-draft-20190616</p>
<p>コントリビュータ: Alon Amid, Krste Asanovic, Allen Baum, Alex Bradbury,
Tony Brewer, Chris Celio, Aliaksei Chapyzhenka, Silviu Chiricescu, Ken
Dockser, Bob Dreyer, Roger Espasa, Sean Halle, John Hauser, David
Horner, Bruce Hoult, Bill Huffman, Constantine Korikov, Ben Korpan,
Robin Kruppe, Yunsup Lee, Guy Lemieux, Filip Moc, Rich Newell, Albert
Ou, David Patterson, Colin Schmidt, Alex Solomatnikov, Steve Wallach,
Andrew Waterman, Jim Wilson.</p>
<p>現在のバージョンで分かっている問題点:</p>
<ul class="simple">
<li>エンコーディングフォーマットをより改善する必要がある。</li>
<li>ベクトルメモリに関するコンシステンシモデルを明らかにする必要がある。</li>
<li>特権アーキテクチャとの相互関係について説明する必要がある。</li>
</ul>
<div class="section" id="id1">
<h1>1. イントロダクション<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>このドキュメントはRISC-Vのベースベクトル拡張について説明するものである。このドキュメントはベースベクトル拡張のすべての個々の機能について説明するものである。</p>
<blockquote>
<div>本ドキュメントは、実装及び評価に用いられるベクトル仕様の安定版プロポーザルのドラフト仕様である。ドラフトのラベルが外れると、Version
0.7はツールチェインの開発、機能シミュレータ、初期の実装に関して十分に安定しているという意図を持ち、マイナーチェンジ及びアップデートが行われていく。</div></blockquote>
<p>「ベースベクトル拡張」という言葉はベクトルISAコンポーネントの標準的な集合を説明するためのインフォーマルな用語として使用されている。ドラフト版の仕様は特定のベクトル機能がベクトル命令としてどのように実装することができるのかについて把握する意味を持っているが、どのようなベクトル命令のセットが与えられたプラットフォームに対して十分であるかについて決定されている訳ではない。</p>
<blockquote>
<div>各実際のプラットフォーム
プロファイルは、そのプラットフォームで採用されているベクター拡張の必須コンポーネントを正式に指定します。基本ベクトル拡張は、ベクトルをサポートする標準
Unix プラットフォーム
プロファイルで最終的に使用されるものに近いと予想されます。組み込みプラットフォームを含む他のプラットフォームは、これらの拡張機能のサブセットを実装することを選択できます。特定のプロファイルに準拠する実装の必須サポート手順の正確なセットは、各プロファイル仕様が批准されるまで変更される可能性があります。</div></blockquote>
<p>このベースベクトル命令は、暗号処理や機械学習などの様々なドメイン向けに拡張された追加ベクトル命令として動作するように設計されている。</p>
</div>
<div class="section" id="id2">
<h1>2. 実装により決定される定数パラメータ<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>各hartはベクトル拡張をサポートすることにより以下の3つのパラメータを持つことになる。</p>
<ol class="arabic simple">
<li>1ベクトル要素の最大ビットサイズ<em>ELEN</em>。2の累乗の必要がある。</li>
<li>ベクトルレジスタのビットサイズ<em>VLEN ≥ ELEN</em>, 2の累乗の必要がある。</li>
<li>ストリップビット距離<em>SLEN</em>。VLEN ≥ SLEN ≥ 32
である必要がある。それぞれは2の累乗の必要がある。</li>
</ol>
<p>プラットフォームのプロファイルにはこれらのパラメータに関して更なる制約が入る可能性がある。例えば、ELEN
≥ max(XLEN,FLEN)や、最小VLEN値、SLEN値の設定など。</p>
<p>ISAは上記の制約情報をバイナリコードで記述することができ、hartは個のバイナリコードを参照することで異なるパラメータで異なる動作ができるようになる。</p>
<blockquote>
<div>コードにより実装パラメータの違いを表現できるようになる。</div></blockquote>
<blockquote>
<div>アクティブなベクトル状態のスレッドコンテキストで、異なるVLEN, ELEN,
SLENパラメータを持つスレッド同士はmitigateすることはできない。</div></blockquote>
</div>
<div class="section" id="id3">
<h1>3. ベクトル拡張のプログラミングモデル<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>ベクトル拡張ではベースとなるスカラRISC-V
ISAに対して32個のベクトルレジスタと、5つの非特権CSRレジスタ(<code class="docutils literal notranslate"><span class="pre">vstart</span></code>,
<code class="docutils literal notranslate"><span class="pre">vxsat</span></code>, <code class="docutils literal notranslate"><span class="pre">vxrm</span></code>, <code class="docutils literal notranslate"><span class="pre">vtype</span></code>,
<code class="docutils literal notranslate"><span class="pre">vl</span></code>)が加えられる。ベースのスカラISAが浮動小数点命令を含まない、<code class="docutils literal notranslate"><span class="pre">fcsr</span></code>レジスタがさらに追加され、<code class="docutils literal notranslate"><span class="pre">vxsat</span></code>と<code class="docutils literal notranslate"><span class="pre">vxrm</span></code>のコピーが格納される。以下に各CSRレジスタの仕様を示す。</p>
<p>表1. 新ベクトルCSR</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="17%" />
<col width="13%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Address</th>
<th class="head">Privilege</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x008</td>
<td>URW</td>
<td>vstart</td>
<td>ベクトルスタート位置を示すレジスタ</td>
</tr>
<tr class="row-odd"><td>0x009</td>
<td>URW</td>
<td>vxsat</td>
<td>浮動小数点飽和フラグレジスタ</td>
</tr>
<tr class="row-even"><td>0x00A</td>
<td>URW</td>
<td>vxrm</td>
<td>浮動小数点丸めモードレジスタ</td>
</tr>
<tr class="row-odd"><td>0xC20</td>
<td>URO</td>
<td>vl</td>
<td>ベクトル長レジスタ</td>
</tr>
<tr class="row-even"><td>0xC21</td>
<td>URO</td>
<td>vtype</td>
<td>ベクトルデータ型レジスタ</td>
</tr>
</tbody>
</table>
<div class="section" id="id4">
<h2>3.1 ベクトルレジスタ<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトル拡張ではベースのスカラRISC-V
ISAに対して32個のアーキテクチャベクトルレジスタ<code class="docutils literal notranslate"><span class="pre">v0</span></code>-<code class="docutils literal notranslate"><span class="pre">v31</span></code>が加わっている。</p>
<p>それぞれのベクトルレジスタはVLENビットだけのビットを保持する。</p>
<blockquote>
<div>Zfinx(“F in
X”)は新しいISAのオプションとして考えられているもので、不動小ステン命令が整数レジスタファイルをレジスタ引数として取ることができるようになるものである。0.7ベクトル拡張ではこのオプションとの互換性を持っている。</div></blockquote>
</div>
<div class="section" id="vtype">
<h2>3.2 ベクトル型レジスタ, <code class="docutils literal notranslate"><span class="pre">vtype</span></code><a class="headerlink" href="#vtype" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">vtype</span></code>レジスタはXLENビット長のRead-onlyなCSRであり、ベクトルレジスタファイルに含まれるデフォルトのデータ型を示している。<code class="docutils literal notranslate"><span class="pre">vtype</span></code>は<code class="docutils literal notranslate"><span class="pre">vsetvl{i}</span></code>命令の実行でしかアップデートすることができない。ベクトル型は各ベクトルレジスタ内の要素の構成についても決定し、どのように複数のベクトルレジスタをグループ化するかについても決定する。</p>
<blockquote>
<div>初期のドラフト版では、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>レジスタは通常のCSR書き込み命令でも書き込みを行うことが可能であった。<code class="docutils literal notranslate"><span class="pre">vsetvl{i}</span></code>命令でのみアップデートが可能である仕様に変更したのは、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>レジスタの管理をより簡単化するためである。</div></blockquote>
<p>ベースベクトル拡張では、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>レジスタは3つのフィールドを持っている。<code class="docutils literal notranslate"><span class="pre">vill</span></code>,
<code class="docutils literal notranslate"><span class="pre">vsew[2:0]</span></code>, <code class="docutils literal notranslate"><span class="pre">vlmul[1:0]</span></code>である。</p>
<p>表2. <code class="docutils literal notranslate"><span class="pre">vtype</span></code>レジスタレイアウト</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="15%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Bits</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>XLEN-1</td>
<td>vill</td>
<td>不正な値が設定されると1が設定される</td>
</tr>
<tr class="row-odd"><td>XLEN-2:7</td>
<td>&#160;</td>
<td>予約(write 0)</td>
</tr>
<tr class="row-even"><td>6:5</td>
<td>vediv[1:0]</td>
<td>EDIV拡張に使用される</td>
</tr>
<tr class="row-odd"><td>4:2</td>
<td>vsew[2:0]</td>
<td>SEW(Standard Element Width 標準エレメント幅)の設定に使用される</td>
</tr>
<tr class="row-even"><td>1:0</td>
<td>vlmul[1:0]</td>
<td>ベクトルレジスタのグループ乗算(LMUL)の設定に使用される</td>
</tr>
</tbody>
</table>
<blockquote>
<div><p>最小のベース実装では、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>では4ビットが必要である。<code class="docutils literal notranslate"><span class="pre">vsew[1:0]</span></code>の2ビットと<code class="docutils literal notranslate"><span class="pre">vlmul[1:0]</span></code>の2ビットである。<code class="docutils literal notranslate"><span class="pre">vill</span></code>の不正な値の設定は、<code class="docutils literal notranslate"><span class="pre">vsew[1:0]</span></code>を使用した64ビットのコンビネーションによりエンコードできる。これにより<code class="docutils literal notranslate"><span class="pre">vill</span></code>ビットの実装を省略することができる。</p>
<p><code class="docutils literal notranslate"><span class="pre">vediv[1:0]</span></code>フィールドは以下に説明するEDIV命令で使用される。</p>
</div></blockquote>
<blockquote>
<div><p>ベクトルベース拡張に対するさらなる標準・カスタム拡張に関しては、上記のフィールドを拡張してより多くのデータタイプをサポートできるようにする。</p>
<p>It is anticipated that an extended 64-bit instruction encoding would
allow these fields to be specified statically in the instruction
encoding.</p>
</div></blockquote>
<div class="section" id="vsew">
<h3>3.2.1. ベクトル標準エレメント幅<code class="docutils literal notranslate"><span class="pre">vsew</span></code><a class="headerlink" href="#vsew" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">vsew</span></code>の値は動的<strong>標準エレメント幅: standard element
width(SEW)</strong>を設定する。デフォルトでは、ベクトルレジスタはVLEN /
SEW標準幅エレメントに分割されているように見ることができる。ベースベクトル拡張では、SEWはmax(XLEN,FLEN)までのサイズを指定することができる。</p>
<p>表3. <code class="docutils literal notranslate"><span class="pre">vsew[2:0]</span></code>(standard element width)エンコーディング</p>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="13%" />
<col width="13%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">vsew[2:0]</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
<th class="head">SEW</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>0</td>
<td>0</td>
<td>8</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>0</td>
<td>1</td>
<td>16</td>
</tr>
<tr class="row-even"><td>0</td>
<td>1</td>
<td>0</td>
<td>32</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>1</td>
<td>1</td>
<td>64</td>
</tr>
<tr class="row-even"><td>1</td>
<td>0</td>
<td>0</td>
<td>128</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>0</td>
<td>1</td>
<td>256</td>
</tr>
<tr class="row-even"><td>1</td>
<td>1</td>
<td>0</td>
<td>512</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>1</td>
<td>1</td>
<td>1024</td>
</tr>
</tbody>
</table>
<p>表4. VLEN=128ビットの場合の例</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">SEW</th>
<th class="head">ベクトルサイズあたりの要素数</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>64</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>32</td>
<td>4</td>
</tr>
<tr class="row-even"><td>16</td>
<td>8</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>16</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="vlmul">
<h3>3.2.2 ベクトルレジスタグルーピング(<code class="docutils literal notranslate"><span class="pre">vlmul</span></code>)<a class="headerlink" href="#vlmul" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>複数のベクトルレジスタをグループ化して<strong>ベクトルレジスタグループ</strong>を構成することができる。したがって、単一のベクトル命令が複数のベクトルレジスタを操作することができる。ベクトルレジスタグループは、標準幅の要素から構成される、2倍以上のより長いベクトル長を操作することができるようになる。ベクトルレジスタグループは、よりベクトル長の長いアプリケーションにおいて効率的に命令を実行できるようになる。</p>
<p>グループ内のベクトルレジスタの数は<strong>LMUL</strong>により管理される。この値は2の累乗である必要があり、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>レジスタの<code class="docutils literal notranslate"><span class="pre">vlmul</span></code>フィールドで設定される(LMUL=2^<code class="docutils literal notranslate"><span class="pre">vlmul[1:0]</span></code>)。</p>
<p>VLMAX=LMUL*VLEN/SEWは、現在のSEWおよびLMULの構成で実行できる単一のベクトル命令の最大データエレメントの数である。</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="5%" />
<col width="11%" />
<col width="16%" />
<col width="21%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">vlmul</th>
<th class="head">&#160;</th>
<th class="head">LMUL</th>
<th class="head">#groups</th>
<th class="head">VLMAX</th>
<th class="head">Grouped registers</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>0</td>
<td>1</td>
<td>32</td>
<td>VLEN/SEW</td>
<td>vn (no group)</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>1</td>
<td>2</td>
<td>16</td>
<td>2*VLEN/SEW</td>
<td>vn, vn+1</td>
</tr>
<tr class="row-even"><td>1</td>
<td>0</td>
<td>4</td>
<td>8</td>
<td>4*VLEN/SEW</td>
<td>vn, …, vn+3</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>1</td>
<td>8</td>
<td>4</td>
<td>8*VLEN/SEW</td>
<td>vn, …, vn+7</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">vlmul=01</span></code>の場合、ベクトルレジスタ<code class="docutils literal notranslate"><span class="pre">v</span></code>nはベクトルレジスタ<code class="docutils literal notranslate"><span class="pre">v</span></code>n+1も含み、2倍のビット長を操作することになる。ベクトルオペランドにより指定されるオペランドで、奇数番号のベクトルレジスタを指定した場合は不定命令例外が発生する。</p>
<p>同様に、<code class="docutils literal notranslate"><span class="pre">vlmul=10</span></code>である場合、ベクトル命令は4つのベクトルレジスタを同時に操作する。また、ベクトル命令により指定されるベクトルオペランドが4の倍数でなかった場合は不定命令例外が発生する。<code class="docutils literal notranslate"><span class="pre">vlmul=11</span></code>である場合は、8つのベクトルレジスタを同時に操作し、ベクトルオペランドとして使用されるベクトルレジスタが8の倍数でない場合は不定命令例外が発生する。</p>
<blockquote>
<div>このグループパタン(LMUL=8の場合の<code class="docutils literal notranslate"><span class="pre">v0</span></code>, <code class="docutils literal notranslate"><span class="pre">v8</span></code>, <code class="docutils literal notranslate"><span class="pre">v16</span></code>,
<code class="docutils literal notranslate"><span class="pre">v24</span></code>)は0.6で初めて導入され、浮動小数点の値がベクトルレジスタにオーバライドされた場合に浮動小数点の呼び出し規約に問題が発生することを避けるために導入された。一方で過去の半ではベクトルレジスタのグループ名は連続して付けられていた(LMUL=8では、<code class="docutils literal notranslate"><span class="pre">v0</span></code>,
<code class="docutils literal notranslate"><span class="pre">v1</span></code>, <code class="docutils literal notranslate"><span class="pre">v2</span></code>,
<code class="docutils literal notranslate"><span class="pre">v3</span></code>となる)。0.7では、浮動小数点レジスタは再び分離された。</div></blockquote>
<p>レジスタマスク命令は、LMULの設定に関係なく常に単一ベクトルレジスタに対して機能する。</p>
</div>
<div class="section" id="vill">
<h3>3.2.3. ベクトルタイプ不正 <code class="docutils literal notranslate"><span class="pre">vill</span></code><a class="headerlink" href="#vill" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">vill</span></code>では直前に実行された<code class="docutils literal notranslate"><span class="pre">vsetvl{i}</span></code>命令によりサポートされない値が<code class="docutils literal notranslate"><span class="pre">vtype</span></code>に書き込まれたことをエンコードするために使用される。</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">vill</span></code>ビットはCSRのXLEN-1ビットにより設定される。これにより、不正な値が設定されたかどうかを符号判定の分岐命令により判定できる。</div></blockquote>
<p>もし、<code class="docutils literal notranslate"><span class="pre">vill</span></code>ビットが設定されている場合、どのようなベクトル命令(ベクトルコンフィグレーション命令以外)を実行しても不定命令例外が発生する。</p>
<p><code class="docutils literal notranslate"><span class="pre">vill</span></code>が設定されていると、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>の他の<code class="docutils literal notranslate"><span class="pre">XLEN-1</span></code>ビットは0に設定される。</p>
</div>
</div>
<div class="section" id="vl">
<h2>3.3. ベクトル長レジスタ<code class="docutils literal notranslate"><span class="pre">vl</span></code><a class="headerlink" href="#vl" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>XLENビット長の読み込み専用CSRである<code class="docutils literal notranslate"><span class="pre">vl</span></code>は<code class="docutils literal notranslate"><span class="pre">vsetvli</span></code>および<code class="docutils literal notranslate"><span class="pre">vsetvl</span></code>命令でのみアップデートすることができるレジスタで、<strong>fault-only-first</strong>ベクトルロード命令バリアントである。</p>
<p><code class="docutils literal notranslate"><span class="pre">vl</span></code>レジスタは、ベクトル命令によりアップデートされる要素の数を符号なし整数として保持している。任意の書き込み先ベクトルレジスタグループにおいて、インデックスが<code class="docutils literal notranslate"><span class="pre">vl</span></code>以上の場合は、ベクトル命令の実行中においてゼロが書き込まれる。<code class="docutils literal notranslate"><span class="pre">vstart</span></code>≥<code class="docutils literal notranslate"><span class="pre">vl</span></code>の場合、書き込み先ベクトルレジスタグループにおいてどのような要素もアップデートされない。</p>
<blockquote>
<div>結論として、<code class="docutils literal notranslate"><span class="pre">vl</span></code>=0の場合は<code class="docutils literal notranslate"><span class="pre">vstart</span></code>の値にかかわらず書き込み先ベクトルレジスタグループには何も書きこまれない。</div></blockquote>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">vl</span></code>に実装されるビットの長さは、その実装が最小のデータタイプにおいて実行することができる最大の要素数に依存する。最小のベクトル実装であるRV32IVでは、少なくとも<code class="docutils literal notranslate"><span class="pre">vl</span></code>では0-32までの値を保持する(VLEN=32,
LMUL=8, SEW=8でVLMAXが32となる)を保持するために6ビットが必要となる。</div></blockquote>
</div>
<div class="section" id="csrvstart">
<h2>3.4. ベクトルスタートインデックスCSR<code class="docutils literal notranslate"><span class="pre">vstart</span></code><a class="headerlink" href="#csrvstart" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">vsatrt</span></code>は読み込み専用のCSRで、ベクトル命令により実行される最初の要素のインデックスを示している。</p>
<p>通常、<code class="docutils literal notranslate"><span class="pre">vstart</span></code>はベクトル命令の例外時にハードウェアにより書き込まれる。<code class="docutils literal notranslate"><span class="pre">vsatrt</span></code>の値はどの要素により例外がが発生したか(同期例外及び非同期例外で同様である)を示しており、復帰可能な例外である場合は、どの場所から復帰するかを示している。</p>
<p>すべてのベクトル命令は<code class="docutils literal notranslate"><span class="pre">vstart</span></code>CSRで示されるエレメントの場所から実行され、例外が発生した要素よりも前の要素の結果が邪魔されることがないように設計されている。命令の実行が完了すると、<code class="docutils literal notranslate"><span class="pre">vstart</span></code>CSRは0にリセットされる。</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">vsetvl{i}</span></code>命令を含むすべてのベクトル命令は<code class="docutils literal notranslate"><span class="pre">vstart</span></code>CSRをゼロに設定する。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">vsatrt</span></code>レジスタの値が<code class="docutils literal notranslate"><span class="pre">vl</span></code>以上場合は、どの要素にも実行されず、書き込みベクトルレジスタの<code class="docutils literal notranslate"><span class="pre">vl</span></code>がゼロに設定されることはない。<code class="docutils literal notranslate"><span class="pre">vstart</span></code>レジスタはゼロにリセットされる。</p>
<p><code class="docutils literal notranslate"><span class="pre">vstart</span></code>CSRは最大の要素インデックス(VLMAXよりも1つ小さな値)もしくはlg2(VLEN)まで書き込むことができるようなビットサイズが定義される。<code class="docutils literal notranslate"><span class="pre">vstart</span></code>CSRの上位のビットはハード的にゼロが設定される(ゼロ読み出し、書き込みは無視される)。</p>
<blockquote>
<div>ベクトル長の最大値はLMULの最大設定値(8)およびSEWの最小値(8)により計算され、VLMAX_max=8*VLEN/8=VLENとなる。例えば、VLEN=256であれば、<code class="docutils literal notranslate"><span class="pre">vstart</span></code>は8ビットであり、0から255までを表現することができる。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">vstart</span></code>CSRは非特権コードにより書き込みを行うことができるが、いくつかの実装では<code class="docutils literal notranslate"><span class="pre">vstart</span></code>にゼロ以外の値を書き込むと大幅に速度が低下する可能性がある。したがって、<code class="docutils literal notranslate"><span class="pre">vstart</span></code>はアプリケーションプログラマが使用すべきではない。いくつかのベクトル命令では<code class="docutils literal notranslate"><span class="pre">vstart</span></code>が非ゼロの場合には実行することができず、以下に定義された不定命令例外が発生する。</p>
<p>実装では、<code class="docutils literal notranslate"><span class="pre">vstart</span></code>の値に何らかの値が設定されている状態では例外を発生することを許しており、そのような実装では同じ<code class="docutils literal notranslate"><span class="pre">vtype</span></code>設定においてベクトル命令は結果を生成しない。</p>
<blockquote>
<div>たとえば、いくつかの実装ではベクトル算術演算を実行中には決して例外を発生せず、命令の実行が完了するまで例外の発生を待つことができる。このような実装ではベクトル算術演算命令において<code class="docutils literal notranslate"><span class="pre">vstart</span></code>が非ゼロである場合は例外が発生することを許している。</div></blockquote>
</div>
<div class="section" id="vxrm">
<h2>3.5. ベクトル固定小数点丸目モードレジスタ<code class="docutils literal notranslate"><span class="pre">vxrm</span></code><a class="headerlink" href="#vxrm" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトル固定小数点丸めモードレジスタは2ビットのRead-Write丸めモードビットフィールドを持っている。ベクトル固定小数点丸めは<code class="docutils literal notranslate"><span class="pre">fcsr</span></code>レジスタの上位ビットのビットフィールドを反映しているが、異なるCSRビットアドレスが割り当てられている。浮動小数点を持たないシステムの場合は、ベクトル拡張を追加する場合には<code class="docutils literal notranslate"><span class="pre">fcsr</span></code>レジスタを追加する必要がある。</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="5%" />
<col width="9%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Bits [1:0]</th>
<th class="head">&#160;</th>
<th class="head">略称</th>
<th class="head">丸めモード</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>0</td>
<td>rnu</td>
<td>round-to-nearest-up (add +0.5 LSB)</td>
</tr>
<tr class="row-odd"><td>0</td>
<td>1</td>
<td>rne</td>
<td>round-to-nearest-even</td>
</tr>
<tr class="row-even"><td>1</td>
<td>0</td>
<td>rdn</td>
<td>round-down (truncate)</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>1</td>
<td>rod</td>
<td>round-to-odd (OR bits into LSB, aka “jam”)</td>
</tr>
</tbody>
</table>
<p>Bits[XLEN-1:2]はゼロである。</p>
<blockquote>
<div>丸めモードは<code class="docutils literal notranslate"><span class="pre">csrwi</span></code>命令により1命令で設定できる。</div></blockquote>
</div>
<div class="section" id="vxsat">
<h2>3.6. ベクトル固定小数点飽和フラグ<code class="docutils literal notranslate"><span class="pre">vxsat</span></code><a class="headerlink" href="#vxsat" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">vxsat</span></code>CSRは1ビットの読み書き可能なビットを保持しており、固定小数点命令の計算結果が書き込み先レジスタのフォーマットに合わせるために飽和した場合に設定される。</p>
<p><code class="docutils literal notranslate"><span class="pre">vxsat</span></code>ビットは<code class="docutils literal notranslate"><span class="pre">fcsr</span></code>レジスタの上位ビットにミラーリングされる。</p>
</div>
<div class="section" id="fcsr">
<h2>3.7. <code class="docutils literal notranslate"><span class="pre">fcsr</span></code>のベクトル固定小数点フィールド<a class="headerlink" href="#fcsr" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">vxrm</span></code>および<code class="docutils literal notranslate"><span class="pre">vxsat</span></code>は分離されたCSRであり浮動小数点CSR<code class="docutils literal notranslate"><span class="pre">fcsr</span></code>からアクセスすることができる。<code class="docutils literal notranslate"><span class="pre">fcsr</span></code>レジスタは浮動小数点をサポートしていない実装でも、ベクトル拡張をサポートしている場合には追加する必要がある。</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="20%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Bits</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>10:9</td>
<td>vxrm</td>
<td>固定小数点丸めモード</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>vxsat</td>
<td>固定小数点精度飽和フラグ</td>
</tr>
<tr class="row-even"><td>7:5</td>
<td>frm</td>
<td>浮動小数点丸目モード</td>
</tr>
<tr class="row-odd"><td>4:0</td>
<td>fflags</td>
<td>浮動小数点例外フラグ</td>
</tr>
</tbody>
</table>
<blockquote>
<div>これらのフィールドは<code class="docutils literal notranslate"><span class="pre">fcsr</span></code>にパッキングされるのは、コンテキストの保存と回復を高速化させるためである。</div></blockquote>
</div>
<div class="section" id="id5">
<h2>3.8. ベクトル拡張のリセット状態について<a class="headerlink" href="#id5" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ベクトル拡張はリセット時に矛盾の発生していない状態でなければならない。特に、<code class="docutils literal notranslate"><span class="pre">vtype</span></code>および<code class="docutils literal notranslate"><span class="pre">vl</span></code>は<code class="docutils literal notranslate"><span class="pre">vsetvl</span></code>命令により読み込みおよびリストアできなければならない。</p>
<blockquote>
<div>リセット時には<code class="docutils literal notranslate"><span class="pre">vtype.vill</span></code>は1が設定されており、残りの<code class="docutils literal notranslate"><span class="pre">vtype</span></code>レジスタはゼロが設定されており、<code class="docutils literal notranslate"><span class="pre">vl</span></code>は0が設定されている状態が推奨される。</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">vstart</span></code>, <code class="docutils literal notranslate"><span class="pre">vxrm</span></code>
,<code class="docutils literal notranslate"><span class="pre">vxsat</span></code>CSRはリセット時にはどのような値が設定されていても構わない。</p>
<blockquote>
<div>ベクトルユニットを使用するときはいかなる時も最初に<code class="docutils literal notranslate"><span class="pre">vsetvl{i}</span></code>を実行し、<code class="docutils literal notranslate"><span class="pre">vstart</span></code>をリセットさせる必要がある。<code class="docutils literal notranslate"><span class="pre">vxrm</span></code>および<code class="docutils literal notranslate"><span class="pre">vxsat</span></code>フィールドはソフトウェアにより使用前に明示的にリセットを行うべきである。</div></blockquote>
<p>ベクトルレジスタはリセット時にはどのような値が設定されていても構わない。</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="RISC-V “V” Extension" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, msyksphinz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>